<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
  <bean id="gwcXmlConfig" class="org.geowebcache.util.XMLConfiguration">
    <constructor-arg type="org.geowebcache.cache.CacheFactory" ref="gwcCacheFactory" />
    <!--By default GWC will look for geowebcache.xml in the WEB-INF/classes folder.-->
    
    <!-- Other samples: -->
    <!--property name="relativePath"><value>../resources</value></property -->
    <!--property name="relativePath"><value>/WEB-INF/classes</value></property-->
    <!--property name="absolutePath"><value>/etc/geowebcache/conf</value></property-->
  </bean>
  

  <!-- If you like to automatically configure GWC from a WMS Getcapabilities document,
       change the values below. The last constructor-arg lets you specify parameters 
       that are appended to every WMS request to the backed, for example: 
       "format_options=regionate_by:auto&amp;bgcolor=0x112233" -->
  <bean id="gwcWMSConfig" class="org.geowebcache.util.GetCapabilitiesConfiguration">
    <constructor-arg type="org.geowebcache.cache.CacheFactory" ref="gwcCacheFactory"/>
    <constructor-arg value="http://127.0.0.1:8080/geoserver/wms?request=GetCapabilities&amp;service=WMS&amp;version=1.1.0"/>
    <constructor-arg value="image/png,image/jpeg,application/vnd.google-earth.kml+xml"/>
    <constructor-arg value="3x3"/><!-- metatiling factors -->
    <constructor-arg value=""/><!-- vendor parameters -->
    <constructor-arg value="false"/><!-- Whether to allow cached=false to specificed for certain requests --> 
    <property name="extentHandlerMap">
	  <ref bean="extentHandlerMap" />
    </property>
  </bean>
  
  <bean id="extentHandlerMap" class="org.geowebcache.util.wms.ExtentHandlerMap">
    <property name="extents">
      <map>
        <entry key="ISO8601" value="org.geowebcache.util.wms.TimeExtentHandler" />
        <entry key="date_time" value="org.geowebcache.util.wms.TimeExtentHandler" />
        <entry key="PTime" value="org.geowebcache.util.wms.TimeExtentHandler" />
        <entry key="m" value="org.geowebcache.util.wms.NumericExtentHandler" />
      </map>
    </property>
  </bean>

  <!-- For each configuration bean above, add them below to activate -->
  <bean id="gwcTLDispatcher" class="org.geowebcache.layer.TileLayerDispatcher">
    <property name="config">
      <list>
	    <ref bean="gwcWMSConfig" />
	    <ref bean="gwcXmlConfig" />
      </list>
    </property>
  </bean>
  
  <!-- controller for handling incoming requests made through the REST interface -->
  <!-- bean id="gwcRESTDispatcher" class="org.geowebcache.rest.RESTDispatcher" destroy-method="destroy">
    <constructor-arg type="org.geowebcache.layer.TileLayerDispatcher" ref="gwcTLDispatcher"/>
    <constructor-arg type="org.geowebcache.util.XMLConfiguration" ref="gwcXmlConfig"/>
  </bean -->
  
  <!-- controller for handling all incoming requests -->
  <bean id="geowebcacheDispatcher" class="org.geowebcache.GeoWebCacheDispatcher" destroy-method="destroy">
    <property name="tileLayerDispatcher" ref="gwcTLDispatcher"/>
    <!-- property name="servletPrefix" value=""/ -->
  </bean>
  
  <!-- Services, make sure you name the bean the same as the path -->
  <bean id="gwcServiceWMS" 
    	class="org.geowebcache.service.wms.WMSService">
    <property name="proxyRequests"><value>TRUE</value></property>
   	<property name="config">
   	  <list>
   	    <ref bean="gwcWMSConfig" />
   	    <ref bean="gwcXmlConfig" />
   	  </list>
   	</property>
  </bean>
  <bean id="gwcServiceGMaps"
	class="org.geowebcache.service.gmaps.GMapsConverter"/>
  <bean id="gwcServiceMGMaps"
	class="org.geowebcache.service.mgmaps.MGMapsConverter"/>
  <bean id="gwcServiceVE"
	class="org.geowebcache.service.ve.VEConverter"/>
  <bean id="gwcServiceKML"
	class="org.geowebcache.service.kml.KMLService"/>

  <!-- Thread pool for seeding -->
  <bean id="gwcSeederThreadPoolExec" 
    class="org.geowebcache.rest.seed.SeederThreadPoolExecutor">
    <constructor-arg value="16"/><!-- Size of core pool -->
    <constructor-arg value="32"/><!-- Maximum size of pool -->
  </bean>

  <!-- Restlets -->
  <bean id="gwcSeedRestlet" class="org.geowebcache.rest.seed.SeedRestlet">
    <property name="XMLConfiguration" ref="gwcXmlConfig"/>
    <property name="tileLayerDispatcher" ref="gwcTLDispatcher"/>
    <property name="threadPoolExecutor" ref="gwcSeederThreadPoolExec"/>
  </bean>  
  <bean id="gwcSeedFormRestlet" class="org.geowebcache.rest.seed.SeedFormRestlet">
    <property name="tileLayerDispatcher" ref="gwcTLDispatcher"/>
    <property name="threadPoolExecutor" ref="gwcSeederThreadPoolExec"/>
  </bean>
  <bean id="gwcReloadRestlet" class="org.geowebcache.rest.reload.ReloadRestlet">
    <property name="tileLayerDispatcher" ref="gwcTLDispatcher"/>
  </bean>
  <bean id="gwcTileLayerRestlet" class="org.geowebcache.rest.layers.TileLayerRestlet">
    <property name="XMLConfiguration" ref="gwcXmlConfig"/>
    <property name="tileLayerDispatcher" ref="gwcTLDispatcher"/>
  </bean>
  
  <!-- REST Dispatcher -->
  <bean id="gwcRestDispatcher" class="org.geowebcache.rest.RESTDispatcher">
    <constructor-arg type="java.util.Map">
      <map>
        <entry>
          <key><value>/seed/{layer}.{extension}</value></key>
          <ref bean="gwcSeedRestlet" />
        </entry>
        <entry>
          <key><value>/seed/{layer}</value></key>
          <ref bean="gwcSeedFormRestlet" />
        </entry>
        <entry>
          <key><value>/reload</value></key>
          <ref bean="gwcReloadRestlet" />
        </entry>
        <entry>
          <key><value>/layers/{layer}.{extension}</value></key>
          <ref bean="gwcTileLayerRestlet" />
        </entry>
      </map>
    </constructor-arg>
  </bean>

  <bean id="gwcProxyDispatcher"
	class="org.geowebcache.proxy.ProxyDispatcher"/>
  
  <bean id="gwcUrlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
    <property name="alwaysUseFullPath" value="true"/>
    <property name="mappings">
      <props>
        <prop key="/service/**">geowebcacheDispatcher</prop>
        <prop key="/demo/**">geowebcacheDispatcher</prop>
	    <prop key="/rest/**">gwcRestDispatcher</prop>
	    <prop key="/proxy/**">gwcProxyDispatcher</prop>
      </props>
    </property>
  </bean>
  
  
  <bean id="gwcCacheKeyFile" class="org.geowebcache.cache.file.DimensionalFilePathKey2" />
  <bean id="gwcCacheFile" class="org.geowebcache.cache.file.FileCache">
    <property name="defaultKeyBeanId"><value>gwcCacheKeyFile</value></property>
  </bean>
  
  
  <!-- Cache and CacheKey factories -->
  <bean id="gwcCacheKeyFactory" class="org.geowebcache.cache.CacheKeyFactory"/>
  
  <bean id="gwcCacheFactory" class="org.geowebcache.cache.CacheFactory">
    <constructor-arg type="org.geowebcache.cache.CacheKeyFactory" ref="gwcCacheKeyFactory"/>
    <property name="defaultCacheBeanId"><value>gwcCacheFile</value></property>
  </bean>
</beans>
