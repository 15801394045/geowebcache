<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
  <bean id="gwcDefaultConfig" class="org.geowebcache.util.PropertiesConfiguration">
    <constructor-arg type="org.geowebcache.cache.CacheFactory" ref="gwcCacheFactory"/>
    <!-- property name="relativePath"><value>/WEB-INF/classes</value></property -->
    <!-- By default GWC will look for .properties files in the resources folder. -->
    <property name="relativePath"><value>../resources</value></property>
    <!-- property name="absolutePath"><value>/etc/geowebcache/conf</value></property -->
    <!-- property name="absolutePath"><value>c:\geowebcache\conf</value></property -->
  </bean>
  
  <bean id="gwcXmlConfig" class="org.geowebcache.util.XMLConfiguration">
    <constructor-arg type="org.geowebcache.cache.CacheFactory" ref="gwcCacheFactory"/>
    <!-- By default GWC will look for layer_properties.xml in the resources folder. -->
    <property name="relativePath"><value>../resources</value></property>
    <!-- property name="relativePath"><value>/WEB-INF/classes</value></property -->
    <!-- property name="absolutePath"><value>/etc/geowebcache/conf</value></property -->
    <!-- property name="absolutePath"><value>/home/ak/masuta/geowebcache/src/main/resources</value></property -->
  </bean> 
  
  <!-- Example for automatically configuring GWC from a WMS getCapabilities document
       Constructor arguments:
       1) Cache factory, bean defined below
       2) URL to get getCapabilities document from
       3) Commaseparated list of supported MIME types
       4) Metatiling factors
       5) Vendor parameters
       Note that these values are applied to ALL layers
    -->
  <!--
  <bean id="gwcWMSConfig" class="org.geowebcache.util.GetCapabilitiesConfiguration">
       <constructor-arg type="org.geowebcache.cache.CacheFactory" ref="gwcCacheFactory"/>
       <constructor-arg value="http://geo.openplans.org/geoserver/wms?request=getCapabilities"/>
       <constructor-arg value="image/png,image/jpeg,application/vnd.google-earth.kml+xml"/>
       <constructor-arg value="3x3"/>
       <constructor-arg value="format_options=regionateby:auto"/>
     </bean>
  -->
  
  <!-- For each configuration bean above, add them below to activate -->
  <bean id="gwcTLDispatcher" class="org.geowebcache.layer.TileLayerDispatcher">
    <property name="config">
      <list>
	<ref bean="gwcXmlConfig"/>
	<!-- ref bean="gwcWMSConfig"/ -->
	<!-- ref bean="gwcGSConfig"/ -->
      </list>
    </property>
  </bean>
  
  <!-- The following list contains the ip that are allowed to seed the cache -->
  <bean id="gwcSeederDispatcher" class="org.geowebcache.seeder.SeederDispatcher">
    <property name="allowedSeeders">
      <list>
	    <value>127.0.0.1</value>
      </list>
    </property>
  </bean>
  
  <!-- controller for handling all incoming requests -->
  <bean id="geowebcacheDispatcher" class="org.geowebcache.GeoWebCacheDispatcher">
    <property name="tileLayerDispatcher" ref="gwcTLDispatcher"/>
    <property name="seederDispatcher" ref="gwcSeederDispatcher"/>
    <!-- property name="servletPrefix" value=""/ -->
  </bean>
  
  <bean id="gwcRESTDispatcher" class="org.geowebcache.RESTDispatcher">
	<constructor-arg type="org.geowebcache.util.XMLConfiguration" ref="gwcXmlConfig"/>
  </bean>
  
  
  
  <!-- Services, make sure you name the bean the same as the path -->
  <bean id="gwcServiceWMS" 
    	class="org.geowebcache.service.wms.WMSService"/>
  <bean id="gwcServiceGMaps"
	class="org.geowebcache.service.gmaps.GMapsConverter"/>
  <bean id="gwcServiceMGMaps"
	class="org.geowebcache.service.mgmaps.MGMapsConverter"/>
  <bean id="gwcServiceVE"
	class="org.geowebcache.service.ve.VEConverter"/>
  <!--bean id="gwcServiceKML" class="org.geowebcache.service.kml.KMLService"/-->
  
  <bean id="gwcCacheFile" class="org.geowebcache.cache.file.FileCache">
    <property name="defaultKeyBeanId"><value>gwcCacheKeyFile</value></property>
  </bean>
  <bean id="gwcCacheKeyFile" class="org.geowebcache.cache.file.FilePathKey2"/>
  
  <bean id="gwcUrlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
    <property name="alwaysUseFullPath" value="true"/>
    <property name="mappings">
      <props>
        <prop key="/service/**">geowebcacheDispatcher</prop>
        <prop key="/seed/**">geowebcacheDispatcher</prop>
        <prop key="/truncate/**">geowebcacheDispatcher</prop>
        <prop key="/rpc/**">geowebcacheDispatcher</prop>
        <prop key="/demo/**">geowebcacheDispatcher</prop>
		<prop key="/rest/**">gwcRESTDispatcher</prop>
      </props>
    </property>
  </bean>
  
  <!-- Cache and CacheKey factories -->
  <bean id="gwcCacheKeyFactory" class="org.geowebcache.cache.CacheKeyFactory"/>
  
  <bean id="gwcCacheFactory" class="org.geowebcache.cache.CacheFactory">
    <constructor-arg type="org.geowebcache.cache.CacheKeyFactory" ref="gwcCacheKeyFactory"/>
    <property name="defaultCacheBeanId"><value>gwcCacheFile</value></property>
  </bean>
</beans>
