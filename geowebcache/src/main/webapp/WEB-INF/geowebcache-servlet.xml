<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
  <bean id="defaultConfig" class="org.geowebcache.util.PropertiesConfiguration">
    <constructor-arg type="org.geowebcache.cache.CacheFactory" ref="cacheFactory"/>
    <property name="relativePath"><value>/WEB-INF/classes</value></property>
    <!-- By default GWC will look for .properties files in the resources folder. -->
    <!-- property name="relativePath"><value>../resources</value></property -->
    <!-- property name="absolutePath"><value>/etc/geowebcache/conf</value></property -->
    <!-- property name="absolutePath"><value>c:\geowebcache\conf</value></property -->
  </bean>
  
  <!-- Example for automatically configuring GWC from a WMS getCapabilities document
       Constructor arguments:
       1) Cache factory, bean defined below
       2) URL to get getCapabilities document from
       3) Commaseparated list of supported MIME types
       4) Metatiling factors
    -->
    
     <bean id="wmsConfig" class="org.geowebcache.util.GetCapabilitiesConfiguration">
       <constructor-arg type="org.geowebcache.cache.CacheFactory" ref="cacheFactory"/>
       <constructor-arg value="http://sigma.openplans.org:8080/geosearch/wms?request=getCapabilities"/>
       <constructor-arg value="image/png,image/jpeg,geosearch-kml"/>
       <constructor-arg value="3x3"/>
     </bean>


  <!-- Subclass of the getCapabilities configuration object above, 
       mainly used with GeoServer integration, also looks for GEOSERVER_WMS_URL -->
  <!-- 
  <bean id="gsConfig" class="org.geowebcache.util.GeoServerConfiguration">
    <constructor-arg type="org.geowebcache.cache.CacheFactory" ref="cacheFactory"/>
    <constructor-arg value="image/png,image/jpeg,geosearch-kml"/>
    <constructor-arg value="3x3"/>
  </bean>
  -->

  <!-- For each configuration bean above, add them below to activate -->
  <bean id="tLDispatcher" class="org.geowebcache.layer.TileLayerDispatcher">
    <property name="config">
      <list>
      <!-- ref bean="defaultConfig"/ -->
      <ref bean="wmsConfig"/>
      <!-- ref bean="gsConfig"/ -->
      </list>
    </property>
  </bean>
  
  <!-- For each configuration bean above, add them below to activate -->
  <bean id="seederDispatcher" class="org.geowebcache.seeder.SeederDispatcher">
    <property name="allowedSeeders">
      <list>
	<value>127.0.0.1</value>
      </list>
    </property>
  </bean>
  
  <!-- controller for handling all incoming requests -->
  <bean id="geowebcacheDispatcher" class="org.geowebcache.GeoWebCacheDispatcher">
    <property name="tileLayerDispatcher" ref="tLDispatcher"/>
    <property name="seederDispatcher" ref="seederDispatcher"/>
    <!-- property name="servletPrefix" value=""/ -->
  </bean>
  
  <!-- Services, make sure you name the bean the same as the path -->
  <bean id="serviceWMS" 
    	class="org.geowebcache.service.wms.WMSService"/>
  <bean id="serviceGMaps"
	class="org.geowebcache.service.gmaps.GMapsConverter"/>
  <bean id="serviceMGMaps"
	class="org.geowebcache.service.mgmaps.MGMapsConverter"/>
  <bean id="serviceVE"
	class="org.geowebcache.service.ve.VEConverter"/>
  <bean id="serviceKML"
	class="org.geowebcache.service.kml.KMLService"/>
  
  <bean id="cacheFile" class="org.geowebcache.cache.file.FileCache">
    <property name="defaultKeyBeanId"><value>cacheKeyFile</value></property>
  </bean>
  <bean id="cacheKeyFile" class="org.geowebcache.cache.file.FilePathKey"/>
  
  <bean id="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
    <property name="alwaysUseFullPath" value="true"/>
    <property name="mappings">
      <props>
        <prop key="/service/**">geowebcacheDispatcher</prop>
        <prop key="/seed/**">geowebcacheDispatcher</prop>
      </props>
    </property>
  </bean>
  
  <!-- Cache and CacheKey factories -->
  <bean id="cacheKeyFactory" class="org.geowebcache.cache.CacheKeyFactory"/>
  
  <bean id="cacheFactory" class="org.geowebcache.cache.CacheFactory">
    <constructor-arg type="org.geowebcache.cache.CacheKeyFactory" ref="cacheKeyFactory"/>
    <property name="defaultCacheBeanId"><value>cacheFile</value></property>
  </bean>
</beans>
