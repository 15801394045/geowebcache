<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
	<!-- Add configuration beans here -->
	<bean id="defaultConfig" class="org.geowebcache.util.PropertiesConfiguration">
		<constructor-arg type="org.geowebcache.cache.CacheFactory" ref="cacheFactory"/>
		<!-- 
			By default GeoWebCache will look for .properties 
			files in the resources folder, below oare some examples.
		-->
		<!-- property name="absolutePath"><value>/etc/geowebcache/conf</value></property -->
		<!-- property name="absolutePath"><value>c:\geowebcache\conf</value></property -->
		<!-- property name="relativePath"><value>resources</value></property -->
		<!-- property name="relativePath"><value>resources</value></property -->	
	</bean>
	
	<bean id="geoserverConfig" class="org.geowebcache.util.GetCapabilitiesConfiguration">
		<constructor-arg type="org.geowebcache.cache.CacheFactory" ref="cacheFactory"/>
		<constructor-arg value="http://sigma.openplans.org:8080/geoserver/wms?request=getCapabilities"/>
		<constructor-arg value=""/>
		<constructor-arg value="4x4"/>
	</bean>
	
	<!-- For each configuration bean above, add them below to activate -->
	<bean id="tLDispatcher" class="org.geowebcache.layer.TileLayerDispatcher">
		<!-- property name="config" ref="defaultConfig"/ -->
		<property name="config" ref="geoserverConfig"/>
		<!-- Add additional Configuration beans here -->
	</bean>
				
	<!-- controller for handling all incoming requests -->
	<bean id="geowebcacheDispatcher" class="org.geowebcache.GeoWebCacheDispatcher">
		<property name="tileLayerDispatcher" ref="tLDispatcher"/>
		<!-- property name="servletPrefix" value=""/ -->
	</bean>
	    
    <!-- Services, make sure you name the bean the same as the path -->
    <bean id="serviceWMS" 
    	class="org.geowebcache.service.wms.WMSService"/>
	<bean id="serviceGMaps"
		class="org.geowebcache.service.gmaps.GMapsConverter"/>
	<bean id="serviceVE"
		class="org.geowebcache.service.ve.VEConverter"/>
	<bean id="serviceKML"
		class="org.geowebcache.service.kml.KMLService"/>
			
	<!-- Caches and associated Cache Keys -->
	<bean id="cacheJCS" class="org.geowebcache.cache.jcs.JCSCache">
		<property name="defaultKeyBeanId"><value>cacheKeyJCS</value></property>
	</bean>
	<bean id="cacheKeyJCS" class="org.geowebcache.cache.jcs.JCSKey"/>
	
	<bean id="cacheFile" class="org.geowebcache.cache.file.FileCache">
		<property name="defaultKeyBeanId"><value>cacheKeyFile</value></property>
	</bean>
	<bean id="cacheKeyFile" class="org.geowebcache.cache.file.FilePathKey"/>
	
	<bean id="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="alwaysUseFullPath" value="true"/>
	 	<property name="mappings">
      <props>
        <prop key="/service/**">geowebcacheDispatcher</prop>
      </props>
    </property>
  </bean>
    
  <!-- Cache and CacheKey factories -->
  <bean id="cacheKeyFactory" class="org.geowebcache.cache.CacheKeyFactory"/>
    
  <bean id="cacheFactory" class="org.geowebcache.cache.CacheFactory">
    <constructor-arg type="org.geowebcache.cache.CacheKeyFactory" ref="cacheKeyFactory"/>
    <property name="defaultCacheBeanId"><value>cacheFile</value></property>
  </bean>
	
</beans>
